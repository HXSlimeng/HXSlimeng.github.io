var e=Object.defineProperty,t=(t,a,l)=>(((t,a,l)=>{a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[a]=l})(t,"symbol"!=typeof a?a+"":a,l),l);import{_ as a,d as l,m as s,r as o,q as i,b as n,o as c,c as r,i as u,s as d,u as v,F as h,e as p,x,p as m,h as y,y as f}from"./index.52c34c11.js";let b={x:200,y:-50,step:50};class k{constructor(e){t(this,"x"),t(this,"y"),t(this,"typeOfBlock"),t(this,"timer"),t(this,"blocksId"),t(this,"canLeft"),t(this,"canRight"),t(this,"boxColor"),t(this,"status");const{x:a,y:l}=b;var s,o;this.x=a,this.y=l,this.timer=null,this.typeOfBlock=Math.floor(2*Math.random()),this.blocksId=(s=4,Number(Math.random().toString().substr(3,s)+Date.now()).toString(36)),this.canLeft=!0,this.canRight=!0,this.boxColor="#"+(o=(16777216*Math.random()<<0).toString(16),new Array(7-o.length).join("0")+o),this.status=0}moveLeft(){this.canLeft&&(this.x-=b.step)}moveRight(){this.canRight&&(this.x+=b.step)}quickDown(){}moveDown(){this.y+=b.step}transStatus(){this.status=this.status>=3?this.status=0:this.status++}}const g=["id"];var w=a(l({__name:"index",props:{block:null,allBox:null,completeRowsY:null},emits:["dropNextBlock","updateCompleteRowsY","moveAgainUpdate"],setup(e,{emit:t}){const a=e,{typeOfBlock:l,blocksId:p}=s(a.block);let x=o([]);const m=()=>{if(4==x.value.length){let e=setInterval((()=>{y(a.allBox)?(clearInterval(e),t("moveAgainUpdate",x.value)):(a.block.moveDown(),t("moveAgainUpdate",x.value))}),500)}else{let e=x.value.map((e=>e.id));x.value.forEach(((l,s)=>{let o=setInterval((()=>{let i=!1;a.allBox.forEach((t=>{e.includes(t.id)||(t.y==l.y+50&&t.x==l.x||l.y>=750)&&(i=!0)})),i?(t("moveAgainUpdate",x.value),clearInterval(o)):(t("moveAgainUpdate",x.value),x.value[s].y+=50)}),500)}))}};i((()=>[a.block.x,a.block.y]),(e=>{((e,t)=>{let a=p.value,s=[];switch(l.value){case 2:s=[{id:`1-${a}`,x:e,y:t},{id:`2-${a}`,x:e-50,y:t},{id:`3-${a}`,x:e+50,y:t},{id:`4-${a}`,x:e+100,y:t}];break;case 1:s=[{id:`1-${a}`,x:e,y:t},{id:`2-${a}`,x:e,y:t+50},{id:`3-${a}`,x:e+50,y:t},{id:`4-${a}`,x:e+100,y:t}];break;case 0:s=[{id:`1-${a}`,x:e,y:t},{id:`2-${a}`,x:e,y:t+50},{id:`3-${a}`,x:e+50,y:t},{id:`4-${a}`,x:e+50,y:t+50}];break;case 3:s=[{id:`1-${a}`,x:e,y:t},{id:`2-${a}`,x:e,y:t+50},{id:`3-${a}`,x:e-50,y:t+50},{id:`4-${a}`,x:e+50,y:t+50}]}x.value=s})(e[0],e[1])})),i(x,((e,t)=>{(()=>{let e=!1,t=!1;a.allBox.find((a=>x.value.find((l=>{if(l.y+50==a.y){if(l.x+50==a.x)return t=!0,!0;if(l.x-50==a.x)return e=!0,!0}return!1})))),x.value.find((l=>l.x<=0||e?(a.block.canLeft=!1,!0):l.x>=450||t?(a.block.canRight=!1,!0):(a.block.canLeft&&a.block.canRight||(a.block.canLeft=!0,a.block.canRight=!0),!1)))})()}),{deep:!0}),i(a.completeRowsY,(()=>{x.value=x.value.filter((e=>!a.completeRowsY.includes(e.id))),m()}));const y=e=>{if(x.value.find((e=>e.y>=750)))return!0;let t=!1,a=e,l=e.map((e=>e.id));return a.forEach((e=>x.value.forEach((a=>{l.includes(a.id)||a.y+50==e.y&&a.x==e.x&&(t=!0)})))),t};return n((()=>{(()=>{let e=setInterval((()=>{y(a.allBox)?(clearInterval(e),t("updateCompleteRowsY",x.value)):a.block.moveDown()}),200)})()})),(t,a)=>(c(!0),r(h,null,u(v(x),(t=>(c(),r("div",{id:t.id,class:"blockExamp",style:d({top:`${t.y}px`,left:`${t.x}px`,backgroundColor:e.block.boxColor})},null,12,g)))),256))}}),[["__scopeId","data-v-b5e609fe"]]);const $={class:"app"},R={class:"game_page"},B=(e=>(m("data-v-2043c6d2"),e=e(),y(),e))((()=>p("div",{class:"divider"},null,-1)));var C=a(l({__name:"game",setup(e){let t=o([]),a=o([]),l=o([]);const s=e=>{if(e.find((e=>e.y<50)))return void window.alert("游戏结束！！");t.value.push(...e);let s=new Map;t.value.forEach((e=>{if(s.has(e.y)){let t=s.get(e.y);t.push(e),s.set(e.y,t)}else{let t=[];t.push(e),s.set(e.y,t)}}));let o=[];s.forEach(((e,a)=>{10==e.length&&(o.push(...e.map((e=>e.id))),t.value=t.value.filter((e=>!o.includes(e.id))))})),l.value.push(...o),a.value.push(new k)},i=e=>{t.value=t.value.map((t=>{let a=t;return e.forEach((e=>{e.id==t.id&&(a=e)})),a}))},d=()=>{a.value.push(new k)},m=()=>{a.value=[],t.value=[],l.value=[],f((()=>{a.value.push(new k)}))};return n((()=>{window.onkeydown=e=>{let t=a.value[a.value.length-1];switch(e.key){case"ArrowLeft":t.moveLeft();break;case"ArrowRight":t.moveRight()}},(()=>{var e;let t=Array.from({length:160});const a=document.createDocumentFragment();t.forEach((()=>{let e=document.createElement("div");e.className="dividClass",a.appendChild(e)})),null==(e=document.querySelector(".divider"))||e.appendChild(a)})()})),(e,o)=>(c(),r("div",$,[p("div",R,[(c(!0),r(h,null,u(v(a),(e=>(c(),x(w,{block:e,allBox:v(t),completeRowsY:v(l),onUpdateCompleteRowsY:s,onMoveAgainUpdate:i},null,8,["block","allBox","completeRowsY"])))),256)),B]),p("button",{class:"startBtn",onClick:d},"开始"),p("button",{class:"startBtn",onClick:m},"重新开始")]))}}),[["__scopeId","data-v-2043c6d2"]]);export{C as default};
